# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Development Commands

```bash
# Build the plugin and generate OCLIF manifest
npm run build

# Run tests with TypeScript compilation and coverage
npm run test

# Development usage (run plugin without installing)
./bin/dev.js metadata-coverage check -h

# Link plugin for development with Salesforce CLI
sf plugins link
```

## Architecture

This is a Salesforce CLI plugin built with OCLIF that checks metadata coverage reports for Salesforce projects.

### Core Components

- **Main Command**: `src/commands/metadata-coverage/check.ts` - Primary command implementation that:
  - Accepts source directories, manifests, or metadata types as input
  - Downloads or loads cached metadata coverage reports by API version
  - Uses ComponentSetBuilder from `@salesforce/source-deploy-retrieve` to analyze metadata
  - Validates metadata types against various packaging channels (1GP, 2GP, etc.)

### Key Architecture Patterns

- **OCLIF Framework**: Extends `SfCommand` from `@salesforce/sf-plugins-core`
- **Component Analysis**: Uses Salesforce's `ComponentSetBuilder` to parse metadata from source directories or manifests
- **Channel Validation**: Supports validation against multiple Salesforce channels:
  - Classic Packaging (1GP managed/unmanaged)
  - Second Generation Packaging (2GP managed/unlocked)
  - API channels (Metadata API, Tooling API, Apex Metadata API)
  - Other deployment methods and tooling (changesets, source tracking)

### Data Flow

1. Parse command flags to determine metadata source and target channels
2. Load/download metadata coverage report for specified API version from `data/report-{version}.json`
3. Build ComponentSet from source directories, manifest, or metadata names
4. Iterate through metadata types and validate against coverage report
5. Output unsupported types in table format or JSON

### Special Metadata Handling

- **Settings**: Converts generic "Settings" type to specific "{Type}Settings" format
- **CustomLabel**: Maps to "CustomLabels" in coverage report
- **MatchingRule**: Maps to "MatchingRules" in coverage report

## Project Structure

- `src/commands/` - OCLIF command implementations
- `data/` - Cached metadata coverage reports by API version
- `test/` - Mocha/Chai test files
- `lib/` - Compiled JavaScript output (generated by build)
- `bin/` - Executable scripts for development and production
